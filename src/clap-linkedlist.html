<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.11/d3.min.js"></script>
<script src="Colors.js"></script>

<dom-module id="clap-linkedlist">

  <template>
    <style is="custom-style">
        :host {
            display: block;
            --clap-backgroundColor: #eee;
        }

        #linkedlist {
            margin-left: 30px;
        }

        #linkedListControls {
            @apply(--layout-vertical);
            @apply(--layout-wrap);
            height: 544px;
            width: 384px;
            margin-left: 30px;
        }

        #linkedListControls > paper-card {
            box-sizing: border-box;
            max-width: 184px;
            margin: 4px;
            flex: 0 0 auto;
        }

        paper-card.toggle {
            background: var(--paper-cyan-200);
        }
        paper-card.addElement {
            background: var(--paper-green-200);
        }
        paper-button.addElement {
            background-color: var(--paper-green-500);
            color: white;
        }
        paper-card.searchElement {
            background: var(--paper-yellow-200);
        }
        paper-button.searchElement {
            background-color: var(--paper-yellow-700);
            color: white;
        }
        paper-card.removeElement {
            background: var(--paper-red-200);
        }
        paper-button.removeElement {
            background-color: var(--paper-red-500);
            color: white;
        }

        paper-card.regenerateLinkedList {
            background: var(--paper-brown-200);
        }
        paper-button.regenerateLinkedList {
            background-color: var(--paper-brown-700);
            color: white;
        }

        /*paper-card.card-heading {*/
            /*background: var(--paper-cyan-500);*/
        /*}*/
        paper-button.custom {
            --paper-button-ink-color: var(--paper-pink-a200);
            /* These could also be individually defined for each of the
              specific css classes, but we'll just do it once as an example */
            --paper-button-flat-keyboard-focus: {
                background-color: var(--paper-pink-a200);
                color: white !important;
            };
            --paper-button-raised-keyboard-focus: {
                background-color: var(--paper-pink-a200) !important;
                color: white !important;
            };
        }
        paper-button.custom:hover {
            background-color: var(--paper-indigo-100);
        }
        paper-button.green {
            background-color: var(--paper-green-500);
            color: white;
        }
        paper-button.disabled {
            color: white;
        }
    </style>
    <div id="linkedlist"></div>
      <div id="linkedListControls">
          <paper-card class="toggle" heading="Enable Zoom">
              <div class="card-content"></div>
              <paper-toggle-button class="card-actions" id="linkedListZoomToggleSwitch"></paper-toggle-button>
          </paper-card>
          <paper-card class="addElement" heading="Add first element">
              <div class="card-content">
                  <paper-input id="firstElementData" required label="input value" pattern="[0-9]*" error-message="numbers only!"></paper-input>
              </div>
              <div class="card-actions">
                  <paper-button raised class="custom green" id="addFirstElement-button">Add</paper-button>
              </div>
          </paper-card>
          <paper-card class="addElement" heading="Add last element">
              <div class="card-content">
                  <paper-input id="lastElementData" required label="input value" pattern="[0-9]*" error-message="numbers only!"></paper-input>
              </div>
              <div class="card-actions">
                  <paper-button toggles raised class="custom green" id="addLastElement-button">Add</paper-button>
              </div>
          </paper-card>
          <paper-card class="searchElement" heading="Search by Index">
              <div class="card-content">
                  <paper-input id="searchIndexData" required label="input value" pattern="[0-9]*" error-message="numbers only!"></paper-input>
              </div>
              <div class="card-actions">
                  <paper-button toggles raised class="custom searchElement" id="searchIndex-button">Search</paper-button>
              </div>
          </paper-card>
          <paper-card class="searchElement" heading="Search by Value">
              <div class="card-content">
                  <paper-input id="searchValueData" required label="input value" pattern="[0-9]*" error-message="numbers only!"></paper-input>
              </div>
              <div class="card-actions">
                  <paper-button toggles raised class="custom searchElement" id="searchValue-button">Search</paper-button>
              </div>
          </paper-card>
          <paper-card class="removeElement" heading="Remove first element">
              <div class="card-actions">
                  <paper-button toggles raised class="custom removeElement" id="removeFirstElement-button">Remove</paper-button>
              </div>
          </paper-card>
          <paper-card class="removeElement" heading="Remove last element">
              <div class="card-actions">
                  <paper-button toggles raised class="custom removeElement" id="removeLastElement-button">Remove</paper-button>
              </div>
          </paper-card>
          <paper-card class="regenerateLinkedList" heading="Regenerate Linked List">
              <div class="card-actions">
                  <paper-button toggles raised class="custom regenerateLinkedList" id="regenerateLinkedList-button">Regenerate</paper-button>
              </div>
          </paper-card>
      </div>
  </template>

  <script>

    var colors = new Colors(); //todo: can we use Material Design Colors (https://www.materialui.co/colors)?

    Polymer({
        is: "clap-linkedlist",
        properties: {
            svgOptions: {
                width: 1024,
                height: 300,
                initialArrayLength: 0,
                minElements: 5,
                initialBounds: {
                    lowerBound: 1,
                    upperBound: 100
                },
                linkedList小anvasColor: '#EEEEEE'
            },
            linkedListRectPrevOptions: {
                width: 35,
                height: 50,
                positionX: 180,
                positionY: 135,
                groupTextPositionX: 180,
                groupTextPositionY: 165,
                arrowLineSourceX: 18,
                arrowLineSourceY: 184,
                arrowLineTargetX: -120,
                arrowLineTargetY: 184,
                changeArrowPosition: 20,
                fontSize: 8,
                intervalX: 0,
                textIntervalX: 15,
                text: 'PREV'
            },
            linkedListRectOptions: {
                side: 50,
                positionX: 180,
                positionY: 135,
                groupTextPositionX: 180,
                groupTextPositionY: 165,
                groupIndexTextPositionY: 105,
                movingToPositionY: 107,
                scaleFactor: 10,
                zoomDuration: 500,
                intervalX: 30,
                textIntervalX: 55
            },
            linkedListRectNextOptions: {
                width: 35,
                height: 50,
                positionX: 180,
                positionY: 135,
                groupTextPositionX: 180,
                groupTextPositionY: 165,
                arrowLineSourceX: 92,
                arrowLineSourceY: 134,
                arrowLineTargetX: 220,
                arrowLineTargetY: 134,
                fontSize: 8,
                intervalX: 75,
                textIntervalX: 94,
                text: 'NEXT'
            },
            circleOptions: {
                positionX: 180,
                positionY: 125,
                radius: 20,
                intervalX: 50,
                initInterval: 500,
                initDuration: 500,
                textIntervalX: 50,
                textPositionX: 60,
                circleShowAllEnabled: false
            },
            linkedListRectIndexAxesGroupOption: {
                textIntervalX: 55,
                groupTextPositionX: 180,
                groupIndexTextPositionY: 230,
                movingToPositionY: 255
            },
            searchElement: {
                indexPosition: {cx: 14, cy: 251, x: 14, y: 255},
                valuePosition: {cx: 14, cy: 101, x: 14, y: 105}
            },
            movingSpeed: {
                searchIndex: 250,
                searchValue: 250,
                initInterval: 500,
                initDuration: 500,
                elementsGroup: 1500,
                removeElementsGroup: 500,
                zoomDuration: 1000
            }
        },
        variables: {
            linkedListDefaultData: [1, 5, 8, 5, 7, 13],
            linkedListData: [],
            linkedListSVG: '',
            linkedListRectPrevGroup: '',
            linkedListRectNextGroup: '',
            linkedListRectGroup: '',
            linkedListRectIndexAxesGroup: ''
        },
        ready: function() {
            moduleScope = this;

            this.scopeSubtree(this.$.linkedlist, true);

            this.setLinkedListData();
            this.build小anvas();
            this.addLinkedList();
            this.resize();
        },
        build小anvas: function () {
            moduleScope.variables.linkedListSVG = d3.select(this.$.linkedlist).append("svg")
                    .attr("width", "100%")
                    .attr("height", 300)
                    .attr("id", "linkedListSVGContainer")
                    .attr("class", "linkedListRectSvg")
                    .append("g")
                    .attr("transform", "scale(1)")
                    .append("g");

            moduleScope.variables.linkedListSVG.append("rect")
                    .attr("width", "100%")
                    .attr("height", "100%")
                    .attr("class", "linkedList小anvas")
                    .attr("fill", this.getComputedStyleValue('--clap-backgroundColor'));
        },
        setLinkedListData: function () {
            moduleScope.variables.linkedListDefaultData.forEach(function (val) {
                moduleScope.variables.linkedListData.push(val);
            });
            moduleScope.properties.svgOptions.initialArrayLength = moduleScope.variables.linkedListData.length;
        },
        addLinkedList: function () {
            this.buildRectsPrevGroup();
            this.buildRectsNextGroup();
            this.buildRectsGroup();
            this.buildArrows();
            this.buildIndexAxes();
            this.resetZoomLinkedList();
        },
        buildRectsPrevGroup: function () {
            if(moduleScope.variables.linkedListRectPrevGroup) {moduleScope.variables.linkedListRectPrevGroup.remove()};

            moduleScope.variables.linkedListRectPrevGroup = moduleScope.variables.linkedListSVG.selectAll("g.rectNode")
                    .data(moduleScope.variables.linkedListData)
                    .enter()
                    .append("g")
                    .attr("class", function (d, i) {
                        return "linkedListRectPrevNode" + i;
                    })
                    .on("mouseover", function (d, i) {
                    })
                    .on("mouseout", function (d, i) {
                    });

            moduleScope.variables.linkedListRectPrevGroup
                    .append("rect")
                    .attr("width", moduleScope.properties.linkedListRectPrevOptions.width)
                    .attr("height", moduleScope.properties.linkedListRectPrevOptions.height)
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectPrevOptions.positionX) + moduleScope.properties.linkedListRectPrevOptions.intervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectPrevOptions.positionY)
                    .attr("rx", 6)
                    .attr("ry", 6)
                    .attr("class", function (d, i) {
                        return "rectPrev rectPrev" + i + " linkedListGroup";
                    })
                    .attr("linkID", "prev")
                    .attr("rectPrevIndex", function (d, i) {
                        return moduleScope.variables.linkedListData[i - 1];
                    })
                    .attr("colorIndex", function (d, i) {
                        return moduleScope.variables.linkedListData[i - 1];
                    })
                    .style("stroke", "black")
                    .style("stroke-width", 0.5)
                    .attr("fill", function (d, i) {
                        var colorIndex = d3.select(this).attr("rectPrevIndex");

                        return colors.getColor(colorIndex);
                    });

            moduleScope.variables.linkedListRectPrevGroup.append("text")
                    .text(function (d, i) {
                        return moduleScope.properties.linkedListRectPrevOptions.text;
                    })
                    .attr("class", function (d, i) {
                        return "rectPrevText" + i + " linkedListGroup";
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectPrevOptions.groupTextPositionX) + moduleScope.properties.linkedListRectPrevOptions.textIntervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectPrevOptions.groupTextPositionY - 15)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", moduleScope.properties.linkedListRectPrevOptions.fontSize)
                    .attr("colorIndex", "white")
                    .attr("fill", "white");

            moduleScope.variables.linkedListRectPrevGroup.append("text")
                    .text(function (d, i) {
                        var nextData = moduleScope.variables.linkedListData[i - 1];
                        if (i === 0) {
                            nextData = "null";
                        }
                        return nextData;
                    })
                    .attr("class", function (d, i) {
                        return "rectPrevText" + i + " linkedListGroup";
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectPrevOptions.groupTextPositionX) + moduleScope.properties.linkedListRectPrevOptions.textIntervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectPrevOptions.groupTextPositionY)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "13px")
                    .attr("colorIndex", "white")
                    .attr("fill", "white");
        },
        buildRectsNextGroup: function () {
            if(moduleScope.variables.linkedListRectNextGroup) {moduleScope.variables.linkedListRectNextGroup.remove()};

            moduleScope.variables.linkedListRectNextGroup = moduleScope.variables.linkedListSVG.selectAll("g.rectNode")
                    .data(moduleScope.variables.linkedListData)
                    .enter()
                    .append("g")
                    .attr("class", function (d, i) {
                        return "linkedListRectNextNode" + i + " linkedListGroup";
                    })
                    .on("mouseover", function (d, i) {
                    })
                    .on("mouseout", function (d, i) {
                    });

            moduleScope.variables.linkedListRectNextGroup
                    .append("rect")
                    .attr("width", moduleScope.properties.linkedListRectNextOptions.width)
                    .attr("height", moduleScope.properties.linkedListRectNextOptions.height)
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectNextOptions.positionX) + moduleScope.properties.linkedListRectNextOptions.intervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectNextOptions.positionY)
                    .attr("rx", 6)
                    .attr("ry", 6)
                    .attr("class", function (d, i) {
                        return "rectNext rectNext" + i + " linkedListGroup";
                    })
                    .attr("linkID", "next")
                    .attr("rectNextIndex", function (d, i) {
                        return moduleScope.variables.linkedListData[i + 1];
                    })
                    .attr("colorIndex", function (d, i) {
                        return moduleScope.variables.linkedListData[i + 1];
                    })
                    .style("stroke", "black")
                    .style("stroke-width", 0.5)
                    .attr("fill", function (d, i) {
                        var colorIndex = d3.select(this).attr("rectNextIndex");
                        return colors.getColor(colorIndex);
                    });

            moduleScope.variables.linkedListRectNextGroup.append("text")
                    .text(function (d, i) {
                        return moduleScope.properties.linkedListRectNextOptions.text;
                    })
                    .attr("class", function (d, i) {
                        return "rectNextText" + i + " linkedListGroup";
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectNextOptions.groupTextPositionX) + moduleScope.properties.linkedListRectNextOptions.textIntervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectNextOptions.groupTextPositionY - 15)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", moduleScope.properties.linkedListRectNextOptions.fontSize)
                    .attr("colorIndex", "white")
                    .attr("fill", "white");

            moduleScope.variables.linkedListRectNextGroup.append("text")
                    .text(function (d, i) {
                        var nextData = moduleScope.variables.linkedListData[i + 1];
                        if (moduleScope.variables.linkedListData.length === i + 1) {
                            nextData = "null";
                        }
                        return nextData;
                    })
                    .attr("class", function (d, i) {
                        return "rectNextText" + i + " linkedListGroup";
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectNextOptions.groupTextPositionX) + moduleScope.properties.linkedListRectNextOptions.textIntervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectNextOptions.groupTextPositionY)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "13px")
                    .attr("colorIndex", "white")
                    .attr("fill", "white");
        },
        buildRectsGroup: function () {
            if(moduleScope.variables.linkedListRectGroup) {moduleScope.variables.linkedListRectGroup.remove()};

            moduleScope.variables.linkedListRectGroup = moduleScope.variables.linkedListSVG.selectAll("g.rectNode")
                    .data(moduleScope.variables.linkedListData)
                    .enter()
                    .append("g")
                    .attr("class", function (d, i) {
                        return "linkedListRectNode" + i + " linkedListGroup";
                    })
                    .on("mouseover", function (d, i) {
                    })
                    .on("mouseout", function (d, i) {
                    });

            moduleScope.variables.linkedListRectGroup
                    .append("rect")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectOptions.positionX) + moduleScope.properties.linkedListRectOptions.intervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectOptions.positionY)
                    .attr("class", function (d, i) {
                        return "linkedListRect" + i + " linkedListGroup";
                    })
                    .attr("rectIndex", function (d, i) {
                        return i;
                    })
                    .attr("colorIndex", function (d, i) {
                        return moduleScope.variables.linkedListData[i];
                    })
                    .style("stroke", "black")
                    .style("stroke-width", 0.5)
                    .attr("fill", function (d, i) {
                        return colors.getColor(moduleScope.variables.linkedListData[i]);
                    })
                    .attr("width", moduleScope.properties.linkedListRectOptions.side)
                    .attr("height", moduleScope.properties.linkedListRectOptions.side);

            moduleScope.variables.linkedListRectGroup.append("text")
                    .text(function (d, i) {
                        return moduleScope.variables.linkedListData[i];
                    })
                    .attr("class", function (d, i) {
                        return "rectValueText" + i + " linkedListGroup";
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectOptions.groupTextPositionX) + moduleScope.properties.linkedListRectOptions.textIntervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectOptions.groupTextPositionY)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "13px")
                    .attr("colorIndex", "white")
                    .attr("fill", "white");
        },
        buildIndexAxes: function () {
            if(moduleScope.variables.linkedListRectIndexAxesGroup) {moduleScope.variables.linkedListRectIndexAxesGroup.remove()}

            moduleScope.variables.linkedListRectIndexAxesGroup = moduleScope.variables.linkedListSVG.selectAll("g.rectNode")
                    .data(moduleScope.variables.linkedListData)
                    .enter()
                    .append("g")
                    .attr("class", function (d, i) {
                        return "rectNode" + i + " indexTextGroup";
                    })
                    .on("mouseover", function (d, i) {
                    })
                    .on("mouseout", function (d, i) {
                    });

            moduleScope.variables.linkedListRectIndexAxesGroup
                    .append("text")
                    .text(function (d, i) {
                        return i;
                    })
                    .attr("class", function (d, i) {
                        return "rectIndexText" + i  + " indexTextGroup";
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", function (d, i) {
                        return (i * moduleScope.properties.linkedListRectIndexAxesGroupOption.groupTextPositionX) + moduleScope.properties.linkedListRectIndexAxesGroupOption.textIntervalX;
                    })
                    .attr("y", moduleScope.properties.linkedListRectIndexAxesGroupOption.groupIndexTextPositionY)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "15px")
                    .style("stroke", "black")
                    .style("stroke-width", 0.1)
                    .attr("colorIndex", function (d, i) {
                        return moduleScope.variables.linkedListData[i];
                    })
                    .attr("fill", function (d, i) {
                        return colors.getColor(moduleScope.variables.linkedListData[i]);
                    });
        },
        resetZoomLinkedList: function () {
            moduleScope.variables.linkedListSVG.attr("transform", "translate(1)scale(1)");
        },
        buildArrow: function (element) {
            if(d3.select(element).attr("class").split(" ")[0] !== "rectNext" && d3.select(element).attr("class").split(" ")[0] !== "rectPrev" ) {
                return;
            };

            var colorIndex = d3.select(element).attr("colorIndex");
            if (colorIndex == null) {
                return;
            }

            var sx = Math.floor(d3.select(element).attr("x")) + moduleScope.properties.linkedListRectPrevOptions.changeArrowPosition;
            var sy, tx, ty;

            if(d3.select(element).attr("linkID") === "prev") {
                sy = moduleScope.properties.linkedListRectPrevOptions.arrowLineSourceY;
                tx = sx - moduleScope.properties.linkedListRectPrevOptions.positionX + moduleScope.properties.linkedListRectPrevOptions.intervalX + moduleScope.properties.linkedListRectPrevOptions.width;
                ty = moduleScope.properties.linkedListRectPrevOptions.arrowLineTargetY;
            }

            if(d3.select(element).attr("linkID") === "next") {
                sy = moduleScope.properties.linkedListRectNextOptions.arrowLineSourceY;
                tx =  sx + moduleScope.properties.linkedListRectNextOptions.positionX - moduleScope.properties.linkedListRectNextOptions.intervalX + moduleScope.properties.linkedListRectNextOptions.width;
                ty = moduleScope.properties.linkedListRectNextOptions.arrowLineTargetY;
            }

            var path = moduleScope.variables.linkedListSVG.append("path")
                    .data([{
                        source: {x: sx, y: sy},
                        target: {x: tx, y: ty}
                    }])
                    .attr("class", "line linkedListLine")
                    .style("stroke", function (d, i) {
                        return colors.getColor(colorIndex);
                    })
                    .attr("fill", "none")
                    .attr("stroke-width", "2")
                    .attr("d", lineData);

            var line = d3.svg.line()
                    .x(function (point) {
                        return point.lx;
                    })
                    .y(function (point) {
                        return point.ly;
                    });

            function lineData(d) {
                var dx = d.target.x - d.source.x,
                        dy = d.target.y - d.source.y,
                        dr = dx + dy;

                return "M" + (d.source.x + 0) + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + (d.target.x + 0) + "," + d.target.y;
            }

            var arrow = moduleScope.variables.linkedListSVG.append("path")
                    .attr("id", "arrow")
                    .style("stroke", "#707070")
                    .style("fill", function (d, i) {
                        return colors.getColor(colorIndex);
                    })
                    .attr("d", d3.svg.symbol().type("triangle-down")(10, 1));

            arrow.transition()
                    .duration(500)
                    .ease("linear")
                    .attrTween("transform", translateAlong(path.node()));

            function translateAlong(path) {
                var l = path.getTotalLength();
                var ps = path.getPointAtLength(0);
                var pe = path.getPointAtLength(l);
                var angl = Math.atan2(pe.y - ps.y, pe.x - ps.x) * (180 / Math.PI) - 45;
                var rot_tran = "rotate(" + angl + ")";
                return function (d, i, a) {

                    return function (t) {
                        var p = path.getPointAtLength(t * l);
                        return "translate(" + p.x + "," + p.y + ") " + rot_tran;
                    };
                };
            }

            var totalLength = path.node().getTotalLength();

            path
                    .attr("stroke-dasharray", totalLength + " " + totalLength)
                    .attr("stroke-dashoffset", function (d, i) {
                        return totalLength;
                    })
                    .transition()
                    .duration(500)
                    .ease("linear")
                    .attr("stroke-dashoffset", 0);
        },
        buildArrows: function () {
            moduleScope.variables.linkedListRectPrevGroup.selectAll("rect.rectPrev")
                    .each(function (d, i) {
                        moduleScope.buildArrow(this);
                    });
            moduleScope.variables.linkedListRectNextGroup.selectAll("rect.rectNext")
                    .each(function (d, i) {
                        moduleScope.buildArrow(this);
                    });
        },
        updateLinkedList: function (stepsList) {
            var orderSteps = this.orderSteps(); //[customCommand]();
            var stepsHandler = this.stepsHandler();
            var stepsCollection = orderSteps[stepsList]();

            stepsCollection.reduce(function(promiseChain, item) {
                return promiseChain.then(function() {
                    return new Promise(function(resolve) {
                        if (asyncFunction(item, resolve, stepsList));
                    })
                });
            }, Promise.resolve());

            function asyncFunction(item, cb, stepsList) {
                setTimeout(function() {
                    stepsHandler[item.step](stepsList);
                    cb();
                }, item.timeout);
            };
        },
        orderSteps: function () {
            var orderSteps = [];
            var removeArrows = function (timeout) {
                return {
                    step: "removeArrows",
                    timeout: timeout
                };
            };
            var removeIndexAxes = function (timeout) {
                return {
                    step: "removeIndexAxes",
                    timeout: timeout
                };
            };
            var moveRectsGroup = function (timeout) {
                return {
                    step: "moveRectsGroup",
                    timeout: timeout
                };
            };
            var moveLeftRectsGroup = function (timeout) {
                return {
                    step: "moveLeftRectsGroup",
                    timeout: timeout
                };
            };
            var addRectGroup = function (timeout) {
                return {
                    step: "addRectGroup",
                    timeout: timeout
                };
            };
            var buildArrows = function (timeout) {
                return {
                    step: "buildArrows",
                    timeout: timeout
                };
            };
            var updateIndexTextGroup = function (timeout) {
                return {
                    step: "updateIndexTextGroup",
                    timeout: timeout
                };
            };
            var moveIndex = function (timeout) {
                return {
                    step: "moveIndex",
                    timeout: timeout
                };
            };
            var moveValue = function (timeout) {
                return {
                    step: "moveValue",
                    timeout: timeout
                };
            };
            var moveSearchElement = function (timeout) {
                return {
                    step: "moveSearchElement",
                    timeout: timeout
                };
            };
            var moveBackSearchElement = function (timeout) {
                return {
                    step: "moveBackSearchElement",
                    timeout: timeout
                };
            };
            var buildEqualSign = function (timeout) {
                return {
                    step: "buildEqualSign",
                    timeout: timeout
                };
            };
            var validateElement = function (timeout) {
                return {
                    step: "validateElement",
                    timeout: timeout
                };
            };
            var removeFirstElement = function (timeout) {
                return {
                    step: "removeFirstElement",
                    timeout: timeout
                };
            };
            var removeLastElement = function (timeout) {
                return {
                    step: "removeLastElement",
                    timeout: timeout
                };
            };
            var zoomLinkedList = function (timeout) {
                return {
                    step: "zoomLinkedList",
                    timeout: timeout
                };
            };

            return {
                addFirstElement: function () {
                    orderSteps.push(removeArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(removeIndexAxes(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(zoomLinkedList(moduleScope.properties.movingSpeed.zoomDuration));
                    orderSteps.push(moveRectsGroup(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(addRectGroup(moduleScope.properties.movingSpeed.elementsGroup));
                    orderSteps.push(buildArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(updateIndexTextGroup(moduleScope.properties.movingSpeed.initInterval));

                    return orderSteps;
                },
                addLastElement: function () {
                    orderSteps.push(removeArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(removeIndexAxes(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(zoomLinkedList(moduleScope.properties.movingSpeed.zoomDuration));
                    orderSteps.push(addRectGroup(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(buildArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(updateIndexTextGroup(moduleScope.properties.movingSpeed.initInterval));

                    return orderSteps;
                },
                removeFirstElement: function () {
                    orderSteps.push(removeArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(removeIndexAxes(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(removeFirstElement(moduleScope.properties.movingSpeed.removeElementsGroup));
                    orderSteps.push(moveLeftRectsGroup(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(zoomLinkedList(moduleScope.properties.movingSpeed.zoomDuration));

                    orderSteps.push(addRectGroup(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(buildArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(updateIndexTextGroup(moduleScope.properties.movingSpeed.initInterval));

                    return orderSteps;
                },
                removeLastElement: function () {
                    orderSteps.push(removeArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(removeIndexAxes(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(removeLastElement(moduleScope.properties.movingSpeed.removeElementsGroup));
                    orderSteps.push(addRectGroup(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(zoomLinkedList(moduleScope.properties.movingSpeed.zoomDuration));
                    orderSteps.push(buildArrows(moduleScope.properties.movingSpeed.initInterval));
                    orderSteps.push(updateIndexTextGroup(moduleScope.properties.movingSpeed.initInterval));

                    return orderSteps;
                },
                searchIndex: function () {
                    orderSteps.push(moveBackSearchElement(moduleScope.properties.movingSpeed.searchIndex));
                    orderSteps.push(moveSearchElement(moduleScope.properties.movingSpeed.searchIndex));
                    orderSteps.push(moveIndex(moduleScope.properties.movingSpeed.searchIndex));
                    orderSteps.push(buildEqualSign(moduleScope.properties.movingSpeed.searchIndex));
                    orderSteps.push(validateElement(moduleScope.properties.movingSpeed.searchIndex));

                    return orderSteps;
                },
                searchValue: function () {
                    orderSteps.push(moveValue(moduleScope.properties.movingSpeed.searchValue));
                    orderSteps.push(moveBackSearchElement(moduleScope.properties.movingSpeed.searchValue));
                    orderSteps.push(moveSearchElement(moduleScope.properties.movingSpeed.searchValue));
                    orderSteps.push(buildEqualSign(moduleScope.properties.movingSpeed.searchValue));
                    orderSteps.push(validateElement(moduleScope.properties.movingSpeed.searchValue));

                    return orderSteps;
                }
            }
        },
        stepsHandler: function () {
            var moveElement = moduleScope.moveElement();

            return {
                removeArrows: function () {
                    moduleScope.variables.linkedListSVG.selectAll(".linkedListLine").remove();
                    moduleScope.variables.linkedListSVG.selectAll("#arrow").remove();
                },
                removeIndexAxes: function () {
                    moduleScope.variables.linkedListRectIndexAxesGroup.remove()
                },
                moveRectsGroup: function (id) {
                    var rectsGroup = moduleScope.variables.linkedListSVG.selectAll(".linkedListGroup");
                    rectsGroup.transition()
                            .each("end", function () {
                                var movingElement =  d3.select(this);
                                moveElement[id](movingElement);
                            });
                },
                moveLeftRectsGroup: function (id) {
                    var rectsGroup = moduleScope.variables.linkedListSVG.selectAll(".linkedListGroup");
                    rectsGroup.transition()
                            .each("end", function () {
                                var movingElement =  d3.select(this);
                                moveElement[id](movingElement);
                            });
                },
                addRectGroup: function () {
                    moduleScope.buildRectsPrevGroup();
                    moduleScope.buildRectsNextGroup();
                    moduleScope.buildRectsGroup();
                },
                buildArrows: function () {
                    moduleScope.buildArrows();
                },
                updateIndexTextGroup: function () {
                    moduleScope.buildIndexAxes();
                },
                moveIndex: function (cx, cy, i, searchIndex, item, cb) {
                    var moveElement = moduleScope.moveElement();

                    return moveElement["moveIndex"](cx, cy, i, searchIndex, item, cb);
                },
                moveValue: function (cx, cy, i, searchIndex, item, cb) {
                    var moveElement = moduleScope.moveElement();

                    return moveElement["moveValue"](cx, cy, i, searchIndex, item, cb);
                },
                moveSearchElement: function (cx, cy, i, searchIndex, item, cb) {
                    var moveElement = moduleScope.moveElement();

                    return moveElement["moveSearchElement"](cx, cy, i, searchIndex, item, cb);
                },
                moveBackSearchElement: function (cx, cy, i, searchIndex, item, cb) {
                    var moveElement = moduleScope.moveElement();

                    return moveElement["moveBackSearchElement"](cx, cy, i, searchIndex, item, cb);
                },
                buildEqualSign: function (cx, cy, i, searchIndex, item, cb) {
                    var pathTop = moduleScope.variables.linkedListSVG.append("path")
                            .data([{
                                source: {x: cx + 8, y: cy - 3},
                                target: {x: cx + 18, y: cy - 3}
                            }])
                            .attr("id", "pathTop" + i)
                            .attr("class", "pathTop line")
                            .style("stroke", function () {
                                return colors.getColor(moduleScope.variables.linkedListData[i]);
                            })
                            .style("stroke-width", 0.5)
                            .attr("d", function (d) {
                                var dx = d.target.x - d.source.x,
                                        dy = d.target.y - d.source.y,
                                        dr = 0;
                                return "M" + (d.source.x + 0) + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + (d.target.x + 0) + "," + d.target.y;
                            });
                    var pathBottom = moduleScope.variables.linkedListSVG.append("path")
                            .data([{
                                source: {x: cx + 8, y: cy + 3},
                                target: {x: cx + 18, y: cy + 3}
                            }])
                            .attr("id", "pathBottom" + i)
                            .attr("class", "pathBottom line")
                            .style("stroke", function () {
                                return colors.getColor(moduleScope.variables.linkedListData[i]);
                            })
                            .style("stroke-width", 0.5)
                            .attr("d", function (d) {
                                var dx = d.target.x - d.source.x,
                                        dy = d.target.y - d.source.y,
                                        dr = 0;
                                return "M" + (d.source.x + 0) + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + (d.target.x + 0) + "," + d.target.y;
                            });

                    return cb();
                },
                buildNotEqualSign: function (cx, cy, i) {
                    var pathNotEqual = moduleScope.variables.linkedListSVG.append("path")
                            .data([
                                {
                                    source: {x: cx + 7, y: cy + 9},
                                    target: {x: cx + 18, y: cy - 9}
                                }
                            ])
                            .attr("id", "pathNotEqual" + i)
                            .attr("class", "line")
                            .style("stroke", "red")
                            .style("stroke-width", 0.5)
                            .attr("d", function (d) {
                                var dx = d.target.x - d.source.x,
                                        dy = d.target.y - d.source.y,
                                        dr = 0;
                                return "M" + (d.source.x + 0) + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + (d.target.x + 0) + "," + d.target.y;
                            });
                },
                validateElement: function (cx, cy, i, searchIndex, item, cb, callback, id) {
                    var elementsHandler = moduleScope.elementsHandler();

                    return elementsHandler["validateElement"](cx, cy, i, searchIndex, item, cb, callback, id)
                },
                removeFirstElement: function () {
                    d3.selectAll(".linkedListRectPrevNode0").remove();
                    d3.selectAll(".linkedListRectNextNode0").remove();
                    d3.selectAll(".linkedListRectNode0").remove();
                },
                removeLastElement: function (id) {
                    moduleScope.variables.linkedListSVG.selectAll(".rectPrevNode" + id).remove();
                    moduleScope.variables.linkedListSVG.selectAll(".rectNextNode" + id).remove();
                    moduleScope.variables.linkedListSVG.selectAll(".rectNode" + id).remove();
                },
                zoomLinkedList: function () {
                    if(moduleScope.variables.linkedListData.length < moduleScope.properties.svgOptions.minElements) {return;}

                    var zoom = d3.behavior.zoom()
                            .on("zoom", zoomed);

                    function zoomed() {
                        moduleScope.variables.linkedListSVG.transition()
                                .attr("transform", "translate(" + d3.event.translate + ")scale("+ (d3.event.scale * (moduleScope.properties.svgOptions.initialArrayLength / moduleScope.variables.linkedListData.length)) +")");
                    }

                    moduleScope.variables.linkedListSVG.transition()
                            .call(zoom.event);
                }
            }
        },
        elementsHandler: function () {
            return {
                validateElement: function (cx, cy, i, validateElement, item, cb, callback, id) {
                    var elementColorID = moduleScope.variables.linkedListData[i];

                    if (item !== validateElement) {
                        moduleScope.variables.linkedListSVG.select("#pathTop" + i)
                                .style("stroke", "red");
                        moduleScope.variables.linkedListSVG.select("#pathBottom" + i)
                                .style("stroke", "red");

                        var stepsHandler = moduleScope.stepsHandler();
                            stepsHandler.buildNotEqualSign(cx, cy, i);

                        callback();

                        this.isNotFound(i, validateElement, id);
                    } else {
                        moduleScope.variables.linkedListSVG.select("#pathTop" + i)
                                .style("stroke", function () {
                                    return colors.getColor(elementColorID);
                                });
                        moduleScope.variables.linkedListSVG.select("#pathBottom" + i)
                                .style("stroke", function () {
                                    return colors.getColor(elementColorID);
                                })
                                .transition().delay(300)
                                .each("end", function () {
                                    moduleScope.variables.linkedListSVG.select("#searchElement")
                                            .style("fill", function () {
                                                return colors.getColor(elementColorID);
                                            });
                                    moduleScope.zoomElementHandler(i);
                                })
                                .transition().delay(moduleScope.properties.circleOptions.initDuration * 2.5)
                                .each("end", function () {
                                    var elementsHandler = moduleScope.elementsHandler();
                                        elementsHandler.resetElement(i);
                                });
                    }
                },
                searchIndex: function (cx, cy, i, serchingValue, callback, stepsList) {
                    var searchIndex = Math.floor(moduleScope.variables.linkedListSVG.select("#rectSearchText").text());
                    cy += 150;

                    var orderSteps = moduleScope.orderSteps();
                    var steps = moduleScope.stepsHandler();
                    var stepsCollection = orderSteps[stepsList]();

                    stepsCollection.reduce(function(promiseChain, item) {
                        return promiseChain.then(function() {
                            return new Promise(function(resolve) {
                                if (asyncFunction(item, resolve, stepsList, i, cx, cy, searchIndex, callback, i));
                            })});
                    }, Promise.resolve());

                    function asyncFunction(item, cb, stepsList, i, cx, cy, searchIndex, callback, serchingValue) {
                        setTimeout(function() {
                            steps[item.step](cx, cy, i, searchIndex, serchingValue, cb, callback, stepsList);
                        }, item.timeout);

                    };
                },
                searchValue: function (cx, cy, i, serchingValue, callback, stepsList) {
                    var searchValue = Math.floor(moduleScope.variables.linkedListSVG.select("#rectSearchText").text());
                    var orderSteps = moduleScope.orderSteps();
                    var steps = moduleScope.stepsHandler();
                    var stepsCollection = orderSteps[stepsList]();

                    stepsCollection.reduce(function(promiseChain, item) {
                        return promiseChain.then(function() {
                            return new Promise(function(resolve) {
                                asyncFunction(item, resolve, stepsList, i, cx, cy, searchValue, callback, serchingValue);
                            })
                        });
                    }, Promise.resolve());

                    function asyncFunction(item, cb, stepsList, i, cx, cy, searchIndex, callback, serchingValue) {
                        setTimeout(function() {
                            steps[item.step](cx, cy, i, searchIndex, serchingValue, cb, callback, stepsList);
                        }, item.timeout);
                    };
                },
                isNotFound: function (i, validateElement, id) {
                    if(moduleScope.variables.linkedListData.length - 1 == i) {
                        var elementsHandler = moduleScope.elementsHandler();
                            elementsHandler.resetElement(i);
//                        $("#" + id + "Data").notify(validateElement + " not found", { position:"right" }); //todo: create Material Design notify
                    }
                },
                resetElement: function (i) {
                    moduleScope.variables.linkedListSVG.select(".rectValueText" + i)
                            .attr("y", moduleScope.properties.linkedListRectOptions.groupTextPositionY)
                            .attr("fill", "white");
                    moduleScope.variables.linkedListSVG.select(".rectIndexText" + i)
                            .attr("y", moduleScope.properties.linkedListRectIndexAxesGroupOption.groupIndexTextPositionY);
                    moduleScope.variables.linkedListSVG.select("#searchElement").remove();
                    moduleScope.variables.linkedListSVG.select("#rectSearchText").remove();
                    moduleScope.variables.linkedListSVG.select("#pathTop" + i).remove();
                    moduleScope.variables.linkedListSVG.select("#pathBottom" + i).remove();
                    moduleScope.variables.linkedListSVG.select("#pathNotEqual" + i).remove();
                },
                zoomLinkedList: function () {
                    moduleScope.variables.linkedListSVG.attr("transform", "translate(" + d3.event.translate + ")scale("+ d3.event.scale +")");
                }
            }
        },
        moveElement: function () {
            return {
                addFirstElement: function (movingElement) {
                    movingElement.transition().duration(moduleScope.properties.movingSpeed.elementsGroup)
                            .attr("x", function (d, i) {
                                return Math.floor(d3.select(this).attr("x")) + moduleScope.properties.linkedListRectOptions.positionX;
                            })
                            .attr("fill", function () {
                                return colors.getColor(d3.select(this).attr("colorIndex"));
                            });
                },
                removeFirstElement: function (movingElement) {
                    movingElement.transition().duration(moduleScope.properties.movingSpeed.elementsGroup)
                            .attr("x", function (d, i) {
                                return Math.floor(d3.select(this).attr("x")) - moduleScope.properties.linkedListRectOptions.positionX;
                            })
                            .attr("fill", function () {
                                return colors.getColor(d3.select(this).attr("colorIndex"));
                            });
                },
                addLast: function () {return;},
                moveIndexTextGroup: function (movingElement) {
                    movingElement.attr("y", function (d, i) {
                        return Math.floor(d3.select(this).attr("y")) + moduleScope.properties.linkedListRectIndexAxesGroupOption.movingToPositionY;
                    })
                            .attr("fill", function () {
                                return colors.getColor(d3.select(this).attr("colorIndex"));
                            });
                },
                moveSearchElement: function (cx, cy, i, searchIndex, item, cb) {
                    moduleScope.variables.linkedListSVG.select("#searchElement").transition().duration(moduleScope.properties.movingSpeed.searchValue)
                            .attr("cx", cx - 10)
                            .attr("cy", cy)
                    moduleScope.variables.linkedListSVG.select("#rectSearchText").transition().duration(moduleScope.properties.movingSpeed.searchValue)
                            .attr("x", cx - 10)
                            .attr("y", cy + 4);

                    return cb();
                },
                moveBackSearchElement: function (cx, cy, i, searchIndex, item, cb) {
                    moduleScope.variables.linkedListSVG.select("#pathTop" + (i - 1)).remove();
                    moduleScope.variables.linkedListSVG.select("#pathBottom" + (i - 1)).remove();
                    moduleScope.variables.linkedListSVG.select("#pathNotEqual" + (i - 1)).remove();
                    moduleScope.variables.linkedListSVG.select(".rectIndexText" + (i - 1))
                            .attr("y", moduleScope.properties.linkedListRectIndexAxesGroupOption.groupIndexTextPositionY);
                    moduleScope.variables.linkedListSVG.select(".rectValueText" + (i - 1))
                            .attr("y", moduleScope.properties.linkedListRectOptions.groupTextPositionY)
                            .attr("fill", "white");

                    return cb();
                },
                moveIndex: function (cx, cy, i, searchIndex, item, cb) {
                    var rectIndexText = moduleScope.variables.linkedListSVG.select(".rectIndexText" + i);

                    rectIndexText.transition().duration(moduleScope.properties.movingSpeed.searchIndex)
                            .attr("y", moduleScope.properties.linkedListRectIndexAxesGroupOption.movingToPositionY);

                    return cb();
                },
                moveValue: function (cx, cy, i, searchIndex, item, cb) {
                    var rectValueText = moduleScope.variables.linkedListSVG.select(".rectValueText" + i);

                    rectValueText.transition().duration(moduleScope.properties.movingSpeed.searchValue)
                            .attr("y", moduleScope.properties.linkedListRectOptions.movingToPositionY)
                            .attr("fill", function (d) {
                                return colors.getColor(moduleScope.variables.linkedListData[i]);
                            });

                    return cb();
                }
            }
        },
        addSearchElement: function (data, id) {
            var searchElementOptions = moduleScope.searchElementOptions();

            if(moduleScope.variables.linkedListSVG.select("#searchElement")) {moduleScope.variables.linkedListSVG.select("#searchElement").remove()}

            var circle = moduleScope.variables.linkedListSVG.append("circle")
                    .attr("id", "searchElement")
                    .attr("cx", searchElementOptions[id]().cx)
                    .attr("cy", searchElementOptions[id]().cy)
                    .attr("fill", "red")
                    .attr("r", 13 + "px");

            if(moduleScope.variables.linkedListSVG.select("#rectSearchText")) {
                moduleScope.variables.linkedListSVG.select("#rectSearchText").remove();
                moduleScope.variables.linkedListSVG.select(".pathBottom").remove();
                moduleScope.variables.linkedListSVG.select(".pathTop").remove();
            }

            moduleScope.variables.linkedListSVG.append("text")
                    .text(data)
                    .attr("id", "rectSearchText")
                    .attr("class", function (d, i) {
                        return "rectSearchIndexText" + i;
                    })
                    .attr("text-anchor", "middle")
                    .attr("x", searchElementOptions[id].x)
                    .attr("y", searchElementOptions[id].y)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "13px")
                    .attr("fill", "white");
        },
        searchElement: function (element) {
            // let requests = linkedListData.reduce((promiseChain, item, i) => { //todo: new JS 7 syntax () => {}
            //     return promiseChain.then(() => new Promise((resolve) => {
            //         if(asyncFunction(item, resolve, i, element));
            //     }));
            // }, Promise.resolve());
            //     console.log(element);

            var elementsHandler = this.elementsHandler();
            moduleScope.variables.linkedListData.reduce(function(promiseChain, item, i) {
                return promiseChain.then(function() {
                    return new Promise(function(resolve) {
                        if(asyncFunction(item, resolve, i, element));
                    })});
            }, Promise.resolve());

            function asyncFunction(item, cb, i, element) {
                setTimeout(function() {
                    var cx = Math.floor(moduleScope.variables.linkedListSVG.select(".linkedListRect" + i).attr("x")) - 3;
                    var cy = Math.floor(moduleScope.variables.linkedListSVG.select(".linkedListRect" + i).attr("y")) - 34;

                    elementsHandler[element](cx, cy, i, item, cb, element);
                }, moduleScope.properties.movingSpeed.searchIndex);
            }
        },
        searchElementOptions: function () {
            return {
                searchIndexPosition: function () {
                  return  {cx: 14, cy: 251, x: 14, y: 255};
                },
                searchValue: function () {
                    return  {cx: 14, cy: 101, x: 14, y: 105}
                }
            }
        },
        zoomElementHandler: function (i) {
            var currentX;
            var currentY;
            var currentW;
            var currentH;
            var destinationX;
            var zoomElement = moduleScope.variables.linkedListSVG.select(".rectPrev" + i);
            zoomRects(zoomElement);

            zoomElement = moduleScope.variables.linkedListSVG.select(".rectNext" + i);
            zoomRects(zoomElement);

            zoomElement = moduleScope.variables.linkedListSVG.select(".linkedListRect" + i);
            zoomRects(zoomElement);

            zoomElement = moduleScope.variables.linkedListSVG.selectAll(".rectPrevText" + i);
            destinationX = Math.floor(zoomElement.attr("x")) - moduleScope.properties.linkedListRectOptions.scaleFactor / 2;
            zoomRectsText(zoomElement, destinationX);

            zoomElement = moduleScope.variables.linkedListSVG.selectAll(".rectNextText" + i);
            destinationX = Math.floor(zoomElement.attr("x")) + moduleScope.properties.linkedListRectOptions.scaleFactor / 2;
            zoomRectsText(zoomElement, destinationX);

            function zoomRects(element) {
                element.transition()
                        .duration(moduleScope.properties.linkedListRectOptions.zoomDuration)
                        .attr("x", function (d) {
                            currentX = Math.floor(d3.select(this).attr("x"));
                            return Math.floor(d3.select(this).attr("x")) - moduleScope.properties.linkedListRectOptions.scaleFactor / 2;
                        })
                        .attr("y", function (d) {
                            currentY = Math.floor(d3.select(this).attr("y"));
                            return Math.floor(d3.select(this).attr("y")) - moduleScope.properties.linkedListRectOptions.scaleFactor / 2;
                        })
                        .attr("width", function (d) {
                            currentW = Math.floor(d3.select(this).attr("width"));
                            return Math.floor(d3.select(this).attr("width")) + moduleScope.properties.linkedListRectOptions.scaleFactor;
                        })
                        .attr("height", function (d) {
                            currentH = Math.floor(d3.select(this).attr("height"));
                            return Math.floor(d3.select(this).attr("height")) + moduleScope.properties.linkedListRectOptions.scaleFactor;
                        })
                        .transition()
                        .duration(moduleScope.properties.linkedListRectOptions.zoomDuration)
                        .attr("x", currentX)
                        .attr("y", currentY)
                        .attr("width", currentW)
                        .attr("height", currentH);
            }
            function zoomRectsText(element, destinationX) {
                currentX = Math.floor(element.attr("x"));
                element.transition()
                        .duration(moduleScope.properties.linkedListRectOptions.zoomDuration)
                        .attr("x", destinationX)
                        .transition()
                        .duration(moduleScope.properties.linkedListRectOptions.zoomDuration)
                        .attr("x", currentX);
            }
        },
        resize: function () {
            var elementWidth = moduleScope.properties.linkedListRectPrevOptions.width + moduleScope.properties.linkedListRectOptions.side + moduleScope.properties.linkedListRectNextOptions.width;
            var elementInterval = (moduleScope.properties.linkedListRectOptions.positionX / 2);
            var linkedListWidth = (elementWidth + elementInterval) * moduleScope.variables.linkedListData.length;
            var linkedListScaleFactor = window.innerWidth < linkedListWidth ? window.innerWidth / linkedListWidth : 1;

            moduleScope.variables.linkedListSVG.attr("transform", "translate(1)scale(" + linkedListScaleFactor + ")");
        },
        listeners: {
            'linkedListZoomToggleSwitch.tap': 'linkedListZoomToggleHandler',
            'addFirstElement-button.tap': 'addFirstElementHandler',
            'addLastElement-button.tap': 'addLastElementHandler',
            'searchIndex-button.tap': 'searchIndexHandler',
            'searchValue-button.tap': 'searchValueHandler',
            'removeFirstElement-button.tap': 'removeFirstElementHandler',
            'removeLastElement-button.tap': 'removeLastElementHandler',
            'regenerateLinkedList-button.tap': 'regenerateLinkedListHandler'
        },
        linkedListZoomToggleHandler: function () {
            if(this.$.linkedListZoomToggleSwitch.checked) {
                linkedListEnableZoomFeature();
            } else {
                linkedListDisableZoomFeature();
            }

            function linkedListEnableZoomFeature() {
                moduleScope.variables.linkedListSVG.call(d3.behavior.zoom()
                        .scaleExtent([0.1, 3])
                        .on("zoom", zoom));

                function zoom() {
                    moduleScope.variables.linkedListSVG.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                }
            };
            function linkedListDisableZoomFeature() {
                moduleScope.variables.linkedListSVG.call(d3.behavior.zoom()
                        .on("zoom", null));
            };
        },
        addFirstElementHandler: function () {
            if(this.$.firstElementData.validate()) {

                var firstValue = Math.floor(this.$.firstElementData.value);

                moduleScope.variables.linkedListData.unshift(firstValue);

                this.updateLinkedList("addFirstElement");

                this.$.firstElementData.value = ''; //todo: clear value in input fields?
            }
        },
        addLastElementHandler: function () {
            var lastValue = Math.floor(this.$.lastElementData.value); //todo: check empty value

            moduleScope.variables.linkedListData.push(lastValue);

            this.updateLinkedList("addLastElement");

            this.$.lastElementData.value = ''; //todo: clear value in input fields?
        },
        searchIndexHandler: function () {
            var indexData = Math.floor(this.$.searchIndexData.value);

            if(indexData <= moduleScope.variables.linkedListData.length - 1 && indexData >= 0) {
                this.addSearchElement(indexData, "searchIndexPosition");
                this.searchElement("searchIndex");
            } else {
//                $(this.$.searchIndexData).notify(indexData + " not found", { position:"right" }); //todo: create Material Design notify
            }
        },
        searchValueHandler: function () {
            var valueData = Math.floor(this.$.searchValueData.value);

            this.addSearchElement(valueData, "searchValue");
            this.searchElement("searchValue");
        },
        removeFirstElementHandler: function () {
            moduleScope.variables.linkedListData.shift();
            this.updateLinkedList("removeFirstElement");
        },
        removeLastElementHandler: function () {
            moduleScope.variables.linkedListData.pop();

            this.updateLinkedList("removeLastElement");
        },
        regenerateLinkedListHandler: function () {
            moduleScope.variables.linkedListData.splice(0, moduleScope.variables.linkedListData.length); //todo: if used linkedListData = [1, 5, 8, 5, 7, 13] there error with instance
            moduleScope.variables.linkedListDefaultData.forEach(function (val) {
                moduleScope.variables.linkedListData.push(val);
            });
            moduleScope.variables.linkedListSVG.selectAll("g").remove();
            moduleScope.variables.linkedListSVG.selectAll("path").remove();
            //todo: clear all input elements

            this.addLinkedList();
        }
    })
  </script>

</dom-module>
